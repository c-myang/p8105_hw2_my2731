P8105 Homework 2
================
October 5th, 2022

## Problem 1: NYC Transit Data

### Cleaning the data

We will work with NYC Transit data; which contains information related
to each entrance and exit for each subway station in NYC.

We will read in and clean the data by retaining line, station name,
station latitude / longitude, routes served, entry, vending, entrance
type, and ADA compliance. We also want to convert the entry variable
from character (YES vs NO) to a logical variable.

To achieve this, we will read in the dataset using `read_csv()`, convert
the variable names to snake case using `janitor::clean_names()`, use
`select()` to keep the variables of interest in our data, then use
`mutate()` and `recode()` to convert the `entry` from a character to a
logical variable.

``` r
transit_data = 
  read_csv("./data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv") %>% 
  janitor::clean_names() %>% 
  select(line:entry, vending, ada) %>% 
  mutate(entry = recode(entry, YES = TRUE, NO = FALSE)) 

head(transit_data)
```

    ## # A tibble: 6 × 19
    ##   line  stati…¹ stati…² stati…³ route1 route2 route3 route4 route5 route6 route7
    ##   <chr> <chr>     <dbl>   <dbl> <chr>  <chr>  <chr>  <chr>  <chr>  <chr>  <chr> 
    ## 1 4 Av… 25th St    40.7   -74.0 R      <NA>   <NA>   <NA>   <NA>   <NA>   <NA>  
    ## 2 4 Av… 25th St    40.7   -74.0 R      <NA>   <NA>   <NA>   <NA>   <NA>   <NA>  
    ## 3 4 Av… 36th St    40.7   -74.0 N      R      <NA>   <NA>   <NA>   <NA>   <NA>  
    ## 4 4 Av… 36th St    40.7   -74.0 N      R      <NA>   <NA>   <NA>   <NA>   <NA>  
    ## 5 4 Av… 36th St    40.7   -74.0 N      R      <NA>   <NA>   <NA>   <NA>   <NA>  
    ## 6 4 Av… 45th St    40.6   -74.0 R      <NA>   <NA>   <NA>   <NA>   <NA>   <NA>  
    ## # … with 8 more variables: route8 <dbl>, route9 <dbl>, route10 <dbl>,
    ## #   route11 <dbl>, entrance_type <chr>, entry <lgl>, vending <chr>, ada <lgl>,
    ## #   and abbreviated variable names ¹​station_name, ²​station_latitude,
    ## #   ³​station_longitude

Using `head(transit_data)`, we can see our cleaned data includes 19
variables and 1868 observations. For each station entrance/exit, we have
information about the station name, line, the station latitude and
longitude, the routes it serves, entrance type, whether it has an entry,
has a ticket vendor, and whether it is ADA compliant.

After these steps, these data are not fully tidy. We can see there are
several `route#` columns to indicate each individual subway route a
station serves, making our dataset very wide. Moreover, the `vending`
variable could also be converted to a logical variable, since it is a
binary variable (like `entry` and `ada`).

### Data Exploration

Next, we will explore a few aspects of our data. Using `distinct()`, we
can get the number of unique stations, accounting for stations with the
same name along different lines .

``` r
distinct(transit_data, line, station_name) %>% 
  arrange(station_name)
```

    ## # A tibble: 465 × 2
    ##    line             station_name               
    ##    <chr>            <chr>                      
    ##  1 8 Avenue         103rd St                   
    ##  2 Broadway-7th Ave 103rd St                   
    ##  3 Flushing         103rd St                   
    ##  4 Lexington        103rd St                   
    ##  5 Broadway Jamaica 104th St-102nd St          
    ##  6 Liberty          104th St-Oxford Av         
    ##  7 Lexington        110th St                   
    ##  8 Lenox            110th St-Central Park North
    ##  9 Broadway Jamaica 111th St                   
    ## 10 Flushing         111th St                   
    ## # … with 455 more rows

Arranging the data by station name, we can see the output gave us
entries for each unique combination of station name and line.

In total, there are **465 unique stations**.

Next, we want to know how many stations are ADA compliant. For this, we
can use `group_by` and `summarise` to get the frequency of `TRUE`’s
under the `ada` variable.

``` r
transit_data %>%
  distinct(line, station_name, ada) %>% 
  group_by(ada) %>%
  summarise(n = n())
```

    ## # A tibble: 2 × 2
    ##   ada       n
    ##   <lgl> <int>
    ## 1 FALSE   381
    ## 2 TRUE     84

From our results, we can see that **84 stations are ADA-compliant.**

Finally, we want to know what proportion of entrances/exits without
vending allow entrance. For this, we will `filter` observations to those
with `vending == "NO"`, then use `group_by`, `summarise`, and `mutate`
to compute the proportion of entrances/exits with `entry == "YES"`.

``` r
transit_data %>%
  filter(vending == "NO") %>% 
  group_by(entry) %>%
  summarise(n = n()) %>%
  mutate(freq = n / sum(n))
```

    ## # A tibble: 2 × 3
    ##   entry     n  freq
    ##   <lgl> <int> <dbl>
    ## 1 FALSE   114 0.623
    ## 2 TRUE     69 0.377

From our results, **37.71% of station entrances / exits without vending
allow entry.**

## Problem 2: Mr. Trash Wheel Data

### Reading and cleaning data

First, we will read and clean the Mr. Trash Wheel sheet from the Trash
Wheel Collection Totals Excel file in `./data` folder. We will convert
variable names to snake case, filter out observations without a dumpster
number (to remove rows without dumpster-specific data), round the
`sports_balls` variable to an integer, and add a `vessel` variable to
label all observations in the data as coming from Mr. Trash Wheel sheet.

``` r
mrtrash_wheel = 
  readxl::read_excel("./data/Trash-Wheel-Collection-Totals-7-2020-2.xlsx",
                     sheet = "Mr. Trash Wheel",
                     range = "A2:N534") %>% 
  janitor::clean_names() %>% 
  filter(!is.na(dumpster)) %>% 
  mutate(sports_balls = as.integer(sports_balls)) %>% 
  mutate(vessel = "Mr. Trash Wheel")
```

Next, we will repeat the same reading and cleaning processes in the
Professor Trash Wheel sheet, in the same Excel file. Similarly, we will
add a `vessel` variable to label all observations in the data as coming
from Professor Trash Wheel sheet.

``` r
proftrash_wheel = 
  readxl::read_excel("./data/Trash-Wheel-Collection-Totals-7-2020-2.xlsx",
                     sheet = "Professor Trash Wheel",
                     range = "A2:N116") %>% 
  janitor::clean_names() %>% 
  filter(!is.na(dumpster)) %>% 
  mutate(sports_balls = as.integer(sports_balls)) %>% 
  mutate(vessel = "Professor Trash Wheel")
```

Finally, we can bind the Mr. Trash Wheel and Professor Trash Wheel data
into a single tidy dataset. We can distinguish which observation comes
from which sheet using the `vessel` variable in column 1.

``` r
trash_wheel = 
  bind_rows(mrtrash_wheel, proftrash_wheel) %>% 
  relocate(vessel)
```

### Describing the `trash_wheel` dataset

``` r
skimr::skim(trash_wheel)
```

|                                                  |             |
|:-------------------------------------------------|:------------|
| Name                                             | trash_wheel |
| Number of rows                                   | 524         |
| Number of columns                                | 15          |
| \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_   |             |
| Column type frequency:                           |             |
| character                                        | 2           |
| numeric                                          | 12          |
| POSIXct                                          | 1           |
| \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_ |             |
| Group variables                                  | None        |

Data summary

**Variable type: character**

| skim_variable | n_missing | complete_rate | min | max | empty | n_unique | whitespace |
|:--------------|----------:|--------------:|----:|----:|------:|---------:|-----------:|
| vessel        |         0 |             1 |  15 |  21 |     0 |        2 |          0 |
| month         |         0 |             1 |   3 |   9 |     0 |       13 |          0 |

**Variable type: numeric**

| skim_variable      | n_missing | complete_rate |     mean |       sd |      p0 |     p25 |      p50 |      p75 |      p100 | hist  |
|:-------------------|----------:|--------------:|---------:|---------:|--------:|--------:|---------:|---------:|----------:|:------|
| dumpster           |         0 |             1 |   201.12 |   138.38 |    1.00 |   66.00 |   191.50 |   322.25 |    453.00 | ▇▅▅▅▅ |
| year               |         0 |             1 |  2017.41 |     1.90 | 2014.00 | 2016.00 |  2018.00 |  2019.00 |   2021.00 | ▅▂▇▃▃ |
| weight_tons        |         0 |             1 |     3.03 |     0.84 |    0.61 |    2.47 |     3.09 |     3.57 |      5.62 | ▁▅▇▃▁ |
| volume_cubic_yards |         0 |             1 |    15.30 |     1.54 |    6.00 |   15.00 |    15.00 |    15.00 |     20.00 | ▁▁▁▇▂ |
| plastic_bottles    |         0 |             1 |  2415.96 |  1890.61 |  210.00 | 1075.00 |  1980.00 |  2875.00 |   9830.00 | ▇▅▁▁▁ |
| polystyrene        |         0 |             1 |  2460.14 |  2016.30 |  210.00 |  990.00 |  2000.00 |  3152.50 |  11528.00 | ▇▃▁▁▁ |
| cigarette_butts    |         0 |             1 | 23118.70 | 30100.16 |  980.00 | 5500.00 | 11000.00 | 28000.00 | 310000.00 | ▇▁▁▁▁ |
| glass_bottles      |         0 |             1 |    21.02 |    16.89 |    0.00 |    8.00 |    18.00 |    29.50 |    110.00 | ▇▃▁▁▁ |
| grocery_bags       |         0 |             1 |  1394.08 |  1748.94 |   50.00 |  480.00 |   890.00 |  1752.50 |  13450.00 | ▇▁▁▁▁ |
| chip_bags          |         0 |             1 |  2584.04 |  3231.04 |  180.00 |  878.50 |  1565.00 |  2760.00 |  20100.00 | ▇▁▁▁▁ |
| sports_balls       |         0 |             1 |    10.17 |     9.42 |    0.00 |    3.00 |     8.00 |    14.00 |     56.00 | ▇▃▁▁▁ |
| homes_powered      |         0 |             1 |    43.49 |    21.06 |    0.00 |   33.62 |    48.83 |    57.17 |     93.67 | ▃▃▇▅▁ |

**Variable type: POSIXct**

| skim_variable | n_missing | complete_rate | min        | max        | median     | n_unique |
|:--------------|----------:|--------------:|:-----------|:-----------|:-----------|---------:|
| date          |         0 |             1 | 1900-01-20 | 2021-01-04 | 2018-04-16 |      298 |

In our tidied dataset, we have a tibble containing 15 variables and 524
observations. The variables in the dataset describe several
characteristics of each dumpster collected from either the Mr. Trash or
Professor Trash Wheel. It includes identifiers like the dumpster number
and date, and vessel it originates from. It also describes the weight
(in tons) and volume (in cubic yards) of trash collected, as well as
counts of common types of trash found in the dumpster, such as plastic
bottles, polystyrene, cigarette butts, and sports balls.

Using `summarise`, we can answer some questions about our data.

``` r
total_weight = trash_wheel %>% 
  filter(vessel == "Professor Trash Wheel") %>% 
  summarise(n = sum(weight_tons))

total_sports_balls = trash_wheel %>% 
  filter(vessel == "Mr. Trash Wheel", year == 2020) %>% 
  summarise(n = sum(sports_balls))
```

The total weight of trash collected by Professor Trash Wheel is **135.5
tons.**

The total number of sports balls collected by Mr. Trash Wheel in 2020
was **856.**

## Problem 3: FiveThirtyEight Data

### Reading and cleaning data

First, we will clean the `pols-month.csv` data.

We’ll use `separate()` to break up the variable `mon` into integer
variables year, month, and day. Then, we use `month.name` within the
`mutate` function to replace month number with month name. Then, we’ll
use `ifelse` to create a president variable taking values `gop` and
`dem`, and use `select` to remove `prez_dem`, `prez_gop`, and the `day`
variable.

``` r
pols_month = read_csv("./data/fivethirtyeight_datasets/pols-month.csv") %>% 
  janitor::clean_names() %>% 
  separate(mon, into = c("year", "month", "day"), sep = "-") %>% 
  mutate(month = month.name[as.numeric(month)]) %>% 
  mutate(president = ifelse(prez_dem == 1, "dem", "rep")) %>% 
  select(-prez_dem, -prez_gop, -day)
```

Second, we will clean the data in `snp.csv` using a similar process as
above.

``` r
snp = read_csv("./data/fivethirtyeight_datasets/snp.csv") %>% 
  janitor::clean_names() %>% 
  separate(date, into = c("month", "day", "year"), sep = "/") %>% 
  mutate(month = month.name[as.numeric(month)]) %>% 
  mutate(year = ifelse(year > 15, paste0("19", year), paste0("20", year))) %>% 
  select(-day) %>% 
  relocate(year)
```

Third, tidy the unemployment data so that it can be merged with the
previous datasets. This process will involve switching from “wide” to
“long” format; ensuring that key variables have the same name; and
ensuring that key variables take the same values.

``` r
unemployment = read_csv("./data/fivethirtyeight_datasets/unemployment.csv") %>% 
  janitor::clean_names() %>% 
  pivot_longer(
    jan:dec,
    names_to = "month",
    values_to = "pct_unemployed") %>% 
  mutate(month = month.name[match(str_to_title(month), month.abb)])
```

Finally, we will join the datasets by merging snp into pols, and merging
unemployment into the result.

``` r
five_thirty_eight = 
  left_join(pols_month, snp, by = "year")
```
